<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Farmer GPS Simulator ‚Äî 3 Live Labs</title>
<style>
  :root{
    --bg:#0a0e1a;--card:#1a2540;--text:#e9f2ff;--accent:#9CFF6E;--border:rgba(156,255,110,.3);
    --ok:#9CFF6E;--warn:#FFD166;--bad:#ff6b6b;--blue:#7cf4ff;--violet:#B28DFF;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:ui-rounded,system-ui,sans-serif;background:linear-gradient(180deg,#0a0e1a,#1a3a1a);color:var(--text);min-height:100vh;padding:20px}
  .container{max-width:1200px;margin:0 auto}
  .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
  h1{font-size:2rem;color:var(--accent)}
  .back-btn{padding:10px 18px;background:rgba(156,255,110,.2);border:2px solid var(--border);border-radius:12px;color:var(--accent);text-decoration:none;font-weight:700}
  .section{background:var(--card);border:2px solid var(--border);border-radius:18px;padding:18px;margin:16px 0}
  .title{font-weight:900;color:var(--accent);margin-bottom:10px}
  .lab{display:grid;grid-template-columns:1fr 320px;gap:16px}
  .viz{position:relative;background:#152a15;border:2px solid var(--border);border-radius:16px;padding:14px;min-height:460px;overflow:hidden}
  .panel{background:#142414;border:2px solid var(--border);border-radius:16px;padding:14px}
  .label{display:block;font-weight:900;margin:10px 0 6px;color:var(--accent)}
  .val{display:inline-block;padding:4px 10px;background:rgba(156,255,110,.18);border-radius:8px;font-weight:900}
  .panel input[type="range"], .panel select{width:100%}
  .panel input[type="range"]{height:8px;background:rgba(156,255,110,.2);border-radius:6px}
  .panel input[type="range"]::-webkit-slider-thumb{appearance:none;width:18px;height:18px;border-radius:50%;background:var(--accent)}
  .note{margin-top:10px;background:rgba(255,255,255,.05);border:1px dashed rgba(255,255,255,.14);border-radius:12px;padding:10px}
  .quiz{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
  .quiz button{background:rgba(156,255,110,.12);border:1px solid rgba(156,255,110,.3);color:var(--accent);border-radius:10px;padding:6px 10px;font-weight:900;cursor:pointer}
  .quiz .ok{color:#0f5132;background:rgba(111,230,194,.2);border-color:rgba(111,230,194,.5)}
  .quiz .no{color:#842029;background:rgba(255,107,107,.18);border-color:rgba(255,107,107,.5)}

  /* LAB 1: Row-Tracker */
  .fieldBox{height:420px;border-radius:12px;background:linear-gradient(180deg,#173217,#0f2510);position:relative;overflow:hidden}
  .targetLine{position:absolute;left:50%;top:0;bottom:0;width:2px;background:rgba(255,255,255,.25)}
  .passLine{position:absolute;top:0;left:10%;right:10%;height:2px;background:rgba(255,255,255,.12)}
  .tractor{position:absolute;width:44px;height:44px;border-radius:10px;background:var(--accent);display:flex;align-items:center;justify-content:center;font-size:22px;box-shadow:0 6px 16px rgba(156,255,110,.45)}
  .errCircle{position:absolute;border:2px dashed rgba(255,255,255,.25);border-radius:50%;pointer-events:none}
  .hud{position:absolute;top:10px;left:10px;display:flex;gap:8px;flex-wrap:wrap}
  .badge{background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.15);padding:6px 10px;border-radius:10px;font-weight:900}
  .badge.ok{color:var(--ok)} .badge.warn{color:var(--warn)} .badge.bad{color:var(--bad)}
  .gpsLamp{width:12px;height:12px;border-radius:50%;display:inline-block;margin-right:6px;vertical-align:-2px}
  .spark{position:absolute;width:120px;height:120px;border-radius:50%;background:radial-gradient(circle, rgba(156,255,110,.35), transparent 60%);filter:blur(10px);mix-blend-mode:screen;animation:spark 2.2s linear infinite;opacity:.7}
  @keyframes spark{0%{transform:translate(-20%,-20%) scale(.8)}50%{transform:translate(10%,10%) scale(1)}100%{transform:translate(-20%,-20%) scale(.8)}}

  /* LAB 2: Sky-View & DOP */
  .sky{height:420px;border-radius:12px;background:radial-gradient(circle at 50% 60%, #103010, #0c190c);position:relative;overflow:hidden}
  .horizon{position:absolute;left:0;right:0;bottom:0;height:38%;background:linear-gradient(0deg,#0d260d,transparent)}
  .sat{position:absolute;width:12px;height:12px;border-radius:50%;background:var(--blue);box-shadow:0 0 12px rgba(124,244,255,.9)}
  .sat.bad{background:var(--bad);box-shadow:0 0 14px rgba(255,107,107,.9)}
  .azRing,.elRing{position:absolute;border:1px dashed rgba(255,255,255,.12);border-radius:50%}
  .skyHUD{position:absolute;top:10px;left:10px;display:flex;gap:8px;flex-wrap:wrap}
  .dial{position:absolute;top:10px;right:10px;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.15);padding:10px 12px;border-radius:12px}
  .bar{height:8px;border-radius:6px;background:linear-gradient(90deg,var(--ok),var(--warn),var(--bad))}

  /* LAB 3: Error Heatmap */
  .heat{height:420px;border-radius:12px;background:#0f1c0f;position:relative;overflow:hidden;display:grid;grid-template-columns:repeat(24,1fr);grid-auto-rows:1fr;gap:2px;padding:2px}
  .cell{border-radius:4px;transition:transform .12s}
  .cell:hover{transform:scale(1.15)}
  .legend{position:absolute;bottom:10px;left:10px;right:10px;display:flex;gap:8px;align-items:center}
  .grad{height:10px;flex:1;border-radius:8px;background:linear-gradient(90deg,var(--ok),#bfea5e,#ffd166,#ff9b6b,#ff6b6b,#ff3366)}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <a href=".." class="back-btn">‚Üê Back</a>
    <h1>
      ~
      /
      <a href="..">Space Weather Stories</a>
      /
      <a href="#"> üöú Fred‚Äôs GPS Navigation Labs</a>
      /
    </h1>
  </div>

  <!-- INTRO -->
  <div class="section">
    <div class="title">Follow how space weather bends farm guidance</div>
    <p style="opacity:.9;line-height:1.7;margin-top:6px">
      These three live labs show: (1) row-tracking drift from ionospheric delay, (2) sky geometry & scintillation knocking satellites out, and (3) a day-long error heatmap driven by TEC and storm level.
    </p>
  </div>

  <!-- ============= LAB 1: ROW-TRACKER ============= -->
  <div class="section">
    <div class="title">Lab 1 ‚Äî Row-Tracker</div>
    <div class="lab" id="lab1">
      <div class="viz">
        <div class="fieldBox" id="rtField">
          <div class="spark"></div>
          <div class="targetLine"></div>
          <div class="passLine" style="top:84px"></div>
          <div class="passLine" style="top:168px"></div>
          <div class="passLine" style="top:252px"></div>
          <div class="passLine" style="top:336px"></div>

          <div class="tractor" id="rtTractor">üöú</div>
          <div class="errCircle" id="rtErr"></div>

          <div class="hud">
            <span class="badge" id="rtAcc"><span class="gpsLamp" id="rtLamp"></span>¬±0.6 m</span>
            <span class="badge" id="rtMode">Single-freq</span>
            <span class="badge" id="rtDelay">Delay 0.8 m</span>
            <span class="badge" id="rtTEC">TECU 30</span>
          </div>
        </div>

        <div class="note">
          <p><b>Did you know?</b> At L1, <u>1 TECU ‚âà 0.163 m</u> of range error. Dual-frequency subtracts most ionosphere; RTK adds cm-level corrections.</p>
          <div class="quiz">
            <span class="val">Quiz:</span>
            <button data-q="q1" data-ok="true">Higher TEC ‚Üí larger delay</button>
            <button data-q="q1" data-ok="false">Higher TEC ‚Üí smaller delay</button>
            <span class="val" data-q-res="q1"></span>
          </div>
        </div>
      </div>

      <div class="panel">
        <label class="label">Receiver Mode</label>
        <select id="rtRx">
          <option value="single">Single-freq (L1)</option>
          <option value="dual" selected>Dual-freq (L1/L2)</option>
          <option value="rtk">RTK (base corrections)</option>
        </select>

        <label class="label">Ionospheric Activity (drives TEC)</label>
        <input type="range" id="rtIono" min="0" max="100" value="35"/>
        <div class="val" id="rtIonoV">35%</div>

        <label class="label">Visible Satellites</label>
        <input type="range" id="rtSat" min="4" max="12" value="9"/>
        <div class="val" id="rtSatV">9</div>

        <label class="label">Speed (km/h)</label>
        <input type="range" id="rtSpd" min="0" max="20" value="8"/>
        <div class="val" id="rtSpdV">8 km/h</div>
      </div>
    </div>
  </div>

  <!-- ============= LAB 2: SKY-VIEW ============= -->
  <div class="section">
    <div class="title">Lab 2 ‚Äî Sky-View & DOP</div>
    <div class="lab">
      <div class="viz">
        <div class="sky" id="sky">
          <div class="azRing" style="inset:40px;border-radius:50%"></div>
          <div class="azRing" style="inset:90px;border-radius:50%"></div>
          <div class="azRing" style="inset:140px;border-radius:50%"></div>
          <div class="elRing" style="left:50%;top:20px;bottom:20px;width:1px;background:rgba(255,255,255,.12)"></div>
          <div class="horizon"></div>
          <div class="skyHUD" id="skyHUD">
            <span class="badge" id="pdopB">PDOP 1.9</span>
            <span class="badge" id="s4B">S4 0.2</span>
            <span class="badge" id="lockB">Locked 10</span>
          </div>
          <div class="dial">
            <div style="font-weight:900;margin-bottom:6px">Geometry</div>
            <div class="bar" id="pdBar"></div>
            <div style="opacity:.7;margin-top:6px;font-size:.85rem">Left = good ‚Ä¢ Right = poor</div>
          </div>
        </div>

        <div class="note">
          <p><b>Did you know?</b> Poor sky geometry (high PDOP) magnifies any measurement error. Scintillation (S4) during storms makes satellites ‚Äúblink.‚Äù</p>
          <div class="quiz">
            <span class="val">Quiz:</span>
            <button data-q="q2" data-ok="true">Higher PDOP ‚Üí worse accuracy</button>
            <button data-q="q2" data-ok="false">Higher PDOP ‚Üí better accuracy</button>
            <span class="val" data-q-res="q2"></span>
          </div>
        </div>
      </div>

      <div class="panel">
        <label class="label">Storm Scale (quiet ‚Üí severe)</label>
        <input type="range" id="svStorm" min="0" max="100" value="30"/>
        <div class="val" id="svStormV">30%</div>

        <label class="label">Mask Angle (¬∞ above horizon)</label>
        <input type="range" id="svMask" min="0" max="30" value="5"/>
        <div class="val" id="svMaskV">5¬∞</div>

        <label class="label">Constellations</label>
        <select id="svConst">
          <option value="gps">GPS only</option>
          <option value="gps+glo" selected>GPS + GLONASS</option>
          <option value="gps+glo+gal">GPS + GLONASS + Galileo</option>
        </select>
      </div>
    </div>
  </div>

  <!-- ============= LAB 3: ERROR HEATMAP ============= -->
  <div class="section">
    <div class="title">Lab 3 ‚Äî Day Heatmap (Error vs Time)</div>
    <div class="lab">
      <div class="viz">
        <div class="heat" id="heat"></div>
        <div class="legend">
          <span style="font-weight:900">Error</span>
          <div class="grad"></div>
          <span class="val" id="hmNote">midday peaks during storms</span>
        </div>

        <div class="note" style="position:absolute;top:10px;left:10px;right:10px">
          <p><b>Did you know?</b> TEC usually peaks near local noon and after sunset. During solar storms, the whole curve lifts.</p>
          <div class="quiz">
            <span class="val">Quiz:</span>
            <button data-q="q3" data-ok="true">Storm ‚Üí higher errors all day</button>
            <button data-q="q3" data-ok="false">Storm ‚Üí lower errors all day</button>
            <span class="val" data-q-res="q3"></span>
          </div>
        </div>
      </div>

      <div class="panel">
        <label class="label">Baseline TEC (quiet day)</label>
        <input type="range" id="hmTEC" min="5" max="60" value="25"/>
        <div class="val" id="hmTECV">25 TECU</div>

        <label class="label">Storm Lift (adds to all hours)</label>
        <input type="range" id="hmLift" min="0" max="120" value="30"/>
        <div class="val" id="hmLiftV">+30 TECU</div>

        <label class="label">Receiver</label>
        <select id="hmRx">
          <option value="single">Single-freq</option>
          <option value="dual" selected>Dual-freq</option>
          <option value="rtk">RTK</option>
        </select>
      </div>
    </div>
  </div>
</div>

<script>
/* ===== helpers & quiz ===== */
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
document.addEventListener('click',(e)=>{
  const b=e.target.closest('.quiz button'); if(!b) return;
  const ok=b.dataset.ok==='true', id=b.dataset.q;
  const out=document.querySelector(`[data-q-res="${id}"]`);
  out.textContent=ok?'Correct ‚úÖ':'Try again';
  out.className='val '+(ok?'ok':'no');
});

/* ===== LAB 1: Row-Tracker ===== */
const rtField=document.getElementById('rtField');
const rtTr=document.getElementById('rtTractor');
const rtErr=document.getElementById('rtErr');
const rtAcc=document.getElementById('rtAcc'); const rtLamp=document.getElementById('rtLamp');
const rtMode=document.getElementById('rtMode'); const rtDelay=document.getElementById('rtDelay'); const rtTEC=document.getElementById('rtTEC');
const rtRx=document.getElementById('rtRx'), rtIono=document.getElementById('rtIono'), rtSat=document.getElementById('rtSat'), rtSpd=document.getElementById('rtSpd');
const rtIonoV=document.getElementById('rtIonoV'), rtSatV=document.getElementById('rtSatV'), rtSpdV=document.getElementById('rtSpdV');

function rxFactor(mode){ return mode==='single'?1 : mode==='dual'?0.25 : 0.05; }

let rtY=30, rtXoff=0;
function updateRT(){
  const ion=+rtIono.value, sat=+rtSat.value, spd=+rtSpd.value, mode=rtRx.value;
  rtIonoV.textContent=ion+'%'; rtSatV.textContent=sat; rtSpdV.textContent=spd+' km/h';
  rtMode.textContent= mode==='single'?'Single-freq':mode==='dual'?'Dual-freq':'RTK';
  const TECU = Math.round(10 + ion*1.9);                    // 10..200 TECU
  const ionDelay = 0.163 * TECU * rxFactor(mode);           // meters
  const geom = Math.max(0.8, 4/Math.sqrt(Math.max(4, sat-3)));
  const sigma = (ionDelay*0.6 + geom*0.4);                  // RMS m

  // motion
  const cx=rtField.clientWidth/2;
  const drift=(Math.random()-0.5)*(sigma*0.9)*(0.5+spd/12);
  rtXoff+=drift; rtY+=spd*0.28;
  if(rtY>rtField.clientHeight-44){ rtY=30; rtXoff=(Math.random()-0.5)*20; }
  const tx=cx-22+rtXoff;
  rtTr.style.transform=`translate(${clamp(tx,20,rtField.clientWidth-64)}px,${rtY}px)`;

  // error bubble
  const pxPerM=2, r=clamp(sigma*pxPerM,8,120);
  rtErr.style.width=(2*r)+'px'; rtErr.style.height=(2*r)+'px';
  rtErr.style.left=(tx+22-r)+'px'; rtErr.style.top=(rtY+22-r)+'px';

  // HUD
  rtTEC.textContent=`TECU ${TECU}`;
  rtDelay.textContent=`Delay ${ionDelay.toFixed(1)} m`;
  rtAcc.innerHTML=`<span class="gpsLamp" id="rtLamp"></span>¬±${sigma.toFixed(1)} m`;
  const lamp=document.getElementById('rtLamp');
  if(sigma<1){ lamp.style.background='var(--ok)'; rtAcc.className='badge ok'; }
  else if(sigma<5){ lamp.style.background='var(--warn)'; rtAcc.className='badge warn'; }
  else { lamp.style.background='var(--bad)'; rtAcc.className='badge bad'; }
}
['input','change'].forEach(ev=>[rtRx,rtIono,rtSat,rtSpd].forEach(el=>el.addEventListener(ev,updateRT)));
setInterval(updateRT,120); updateRT();

/* ===== LAB 2: Sky-View ===== */
const sky=document.getElementById('sky'), pdopB=document.getElementById('pdopB'), s4B=document.getElementById('s4B'), lockB=document.getElementById('lockB'), pdBar=document.getElementById('pdBar');
const svStorm=document.getElementById('svStorm'), svStormV=document.getElementById('svStormV');
const svMask=document.getElementById('svMask'), svMaskV=document.getElementById('svMaskV');
const svConst=document.getElementById('svConst');
let sats=[];
function regenSats(){
  sky.querySelectorAll('.sat').forEach(n=>n.remove());
  sats=[];
  const base= svConst.value==='gps'? 14 : svConst.value==='gps+glo'? 22 : 30;
  const N = base;
  for(let i=0;i<N;i++){
    const el = Math.random()*80+10; // elevation 10..90
    const az = Math.random()*360;
    const r = 150*(90-el)/90 + 40; // map elevation to radius
    const cx = sky.clientWidth/2, cy = sky.clientHeight*0.58;
    const x = cx + r*Math.cos(az*Math.PI/180);
    const y = cy + r*Math.sin(az*Math.PI/180) - 60;
    const d = document.createElement('div'); d.className='sat'; d.style.left=(x)+'px'; d.style.top=(y)+'px';
    d.dataset.el=el; d.dataset.az=az; sky.appendChild(d); sats.push(d);
  }
}
function updateSky(){
  const storm=+svStorm.value, mask=+svMask.value;
  svStormV.textContent=storm+'%'; svMaskV.textContent=mask+'¬∞';
  const s4 = (storm/100)*0.9; // 0..0.9
  s4B.textContent = `S4 ${s4.toFixed(2)}`;

  let locked=0;
  sats.forEach(s=>{
    const el=+s.dataset.el;
    const blink = Math.random()< (s4*0.25);     // dropouts
    const masked = el<mask;
    if(blink || masked){ s.classList.add('bad'); }
    else { s.classList.remove('bad'); locked++; }
  });
  lockB.textContent=`Locked ${locked}`;

  // crude PDOP model: better with more spread & count
  const spreadScore = Math.min(1, locked/12);
  const maskPenalty = mask/40;
  const pdop = clamp(1.2 + 2.8*(1-spreadScore) + 1.4*maskPenalty, 1, 6);
  pdopB.textContent=`PDOP ${pdop.toFixed(1)}`;
  pdBar.style.background=`linear-gradient(90deg,var(--ok) ${(6-pdop)/6*100}%, var(--warn) ${(6-pdop)/6*100}%, var(--bad))`;
}
['input','change'].forEach(ev=>[svStorm,svMask,svConst].forEach(el=>el.addEventListener(ev,()=>{ if(el===svConst) regenSats(); updateSky(); })));
regenSats(); setInterval(updateSky,250); updateSky();

/* ===== LAB 3: Heatmap ===== */
const heat=document.getElementById('heat');
const hmTEC=document.getElementById('hmTEC'), hmTECV=document.getElementById('hmTECV');
const hmLift=document.getElementById('hmLift'), hmLiftV=document.getElementById('hmLiftV');
const hmRx=document.getElementById('hmRx');
const hmNote=document.getElementById('hmNote');

// build grid (24 hours x 12 latitude bands as proxy for geometry change)
const H=12, W=24; // rows x cols
function buildHeat(){
  heat.innerHTML='';
  for(let r=0;r<H;r++){
    for(let c=0;c<W;c++){
      const d=document.createElement('div'); d.className='cell'; d.dataset.r=r; d.dataset.c=c; heat.appendChild(d);
    }
  }
}
function rxScale(mode){ return mode==='single'?1 : mode==='dual'?0.35 : 0.08; }
function colorForErr(m){
  // map meters to gradient 0..1
  const t = clamp(m/10, 0, 1);
  // interpolate: ok -> warn -> bad
  if(t<0.5){
    const k=t/0.5; // 0..1
    return `rgb(${Math.round(156+(255-156)*k)}, ${Math.round(255-(255-159)*k)}, ${Math.round(110-(110-102)*k)})`;
  }else{
    const k=(t-0.5)/0.5;
    return `rgb(${Math.round(255)}, ${Math.round(209-(209-107)*k)}, ${Math.round(102-(102-107)*k)})`;
  }
}
function updateHeat(){
  const base=+hmTEC.value, lift=+hmLift.value, mode=hmRx.value;
  hmTECV.textContent=`${base} TECU`; hmLiftV.textContent=`+${lift} TECU`;
  hmNote.textContent = lift>60 ? 'stormy day: errors elevated' : 'quiet/moderate day';

  heat.querySelectorAll('.cell').forEach(cell=>{
    const r=+cell.dataset.r, c=+cell.dataset.c; // r: pseudo-lat band 0..11, c: hour 0..23
    // diurnal TEC shape (two lobes near noon & post-sunset)
    const hourAmp = 0.4 + 0.6*Math.max( Math.exp(-Math.pow((c-12)/5,2)), Math.exp(-Math.pow((c-19)/4,2)) );
    const latScale = 0.8 + 0.4*Math.sin((r/H)*Math.PI); // higher error mid-bands
    const TECU = base*hourAmp*latScale + lift;
    const delay = 0.163 * TECU * rxScale(mode); // meters
    // PDOP-like factor: worse at night (fewer sats in view proxy)
    const pd = 1.3 + 0.9*(1 - Math.exp(-Math.pow((c-3)/6,2))) * (c<6?1:0) + 0.6*(c>18?1:0);
    const err = delay * pd;
    cell.style.background = colorForErr(err);
    cell.title = `Hour ${c}: ~${err.toFixed(1)} m`;
  });
}
['input','change'].forEach(ev=>[hmTEC,hmLift,hmRx].forEach(el=>el.addEventListener(ev,updateHeat)));
buildHeat(); setInterval(updateHeat,600); updateHeat();
</script>
</body>
</html>
